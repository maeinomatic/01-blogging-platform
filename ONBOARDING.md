# Developer Onboarding — Backend & Frontend (local Docker)

This document is a single, copy‑paste friendly onboarding for a new developer joining this repository. It shows exact prerequisites, commands (Windows PowerShell and macOS/Linux), how to run migrations, start the backend, where to find Swagger/OpenAPI, and common troubleshooting steps.

---

## Prerequisites (install in this order)
1. Git (latest stable)
2. Docker & Docker Compose
3. Node.js & npm (if you will run the frontend)
4. Python 3.10+ (install official Python) — we'll use a project virtual environment

Note: the project uses PostgreSQL (local Docker) and FastAPI (backend).

---

## Quick checklist (one‑minute summary)
- Copy `.env.example` → `.env` and set secrets
- Start DB: `docker-compose up -d`
- Create venv & install deps: `python -m venv .venv` → activate → `pip install -r requirements.txt`
- Run migrations: `python -m alembic upgrade head`
- Start backend: `./scripts/run-backend-win.ps1` (Windows) or `uvicorn server.main:app --reload --port 5000` (macOS/Linux)
- Open Swagger UI: `http://127.0.0.1:5000/docs`

---

## Environment variables (important)
- Copy `.env.example` to `.env` and set values for:
  - POSTGRES_USER, POSTGRES_PASSWORD, POSTGRES_DB, POSTGRES_PORT
  - DATABASE_URL (optional — autogenerated from POSTGRES_* values)
  - JWT_SECRET (set a secure random string)

Example DATABASE_URL (backend in host, DB in Docker):
```
postgresql+asyncpg://postgres:postgres@localhost:5432/blogdb
```

When backend runs inside Docker Compose, use `db` as the hostname (service name).

---

## Full setup — Windows (PowerShell)
1. Clone the repo and open the workspace.
2. Copy env and edit secrets:
   ```powershell
   cp .env.example .env
   # edit .env -> set POSTGRES_PASSWORD, JWT_SECRET
   ```
3. Start PostgreSQL in Docker:
   ```powershell
   docker-compose up -d
   docker-compose logs -f db
   ```
4. Create & activate project venv, then install dependencies:
   ```powershell
   python -m venv .venv
   Set-ExecutionPolicy -Scope Process -ExecutionPolicy RemoteSigned -Force
   . .\.venv\Scripts\Activate.ps1
   pip install -r requirements.txt
   ```
5. Apply DB migrations (use venv python):
   ```powershell
   python -m alembic upgrade head
   ```
6. Start the backend API:
   ```powershell
   .\scripts\run-backend-win.ps1
   ```
7. (Optional) Run frontend:
   ```powershell
   cd client
   npm install
   npm start
   ```

---

## Full setup — macOS / Linux (bash)
```bash
git clone <repo-url>
cp .env.example .env
# edit .env
docker-compose up -d
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
python -m alembic upgrade head
uvicorn server.main:app --reload
# frontend (optional)
cd client && npm install && npm start
```

---

## Where to find the API (local dev)
- Swagger UI (interactive docs): http://127.0.0.1:5000/docs
- ReDoc: http://127.0.0.1:5000/redoc
- Health check: http://127.0.0.1:5000/health
- OpenAPI JSON: http://127.0.0.1:5000/openapi.json

Use Swagger UI to exercise endpoints (register/login, posts, comments).

---

## Running migrations (Alembic)
- Create a revision (after model changes):
  - Windows: `python -m alembic revision --autogenerate -m "your message"`
  - macOS/Linux: `alembic revision --autogenerate -m "your message"`
- Apply migrations: `python -m alembic upgrade head`
- Inspect history: `python -m alembic history --verbose`

Notes: Alembic is wired to SQLModel metadata in `alembic/env.py`.

---

## Tests, lint & pre-commit
- Run unit & integration tests: `pytest`
- Run linters and formatters manually:
  - `black .`
  - `ruff .`
- Pre-commit hooks (if configured) run automatically on `git commit`.

---

## VS Code / Editor tips
- Select the workspace Python interpreter to `.venv`:
  - Command Palette → Python: Select Interpreter → choose `.venv` interpreter
- Recommended extensions: Python, Pylance, Prettier/ESLint (frontend), Mermaid Preview

---

## Common troubleshooting
- "DB not ready" → `docker-compose logs db` and `docker-compose exec db pg_isready -U $POSTGRES_USER`.
- Alembic autogenerate complaining about metadata → ensure `server.models` is importable and `SQLModel.metadata` is populated.
- Venv issues on PowerShell → run `Set-ExecutionPolicy -Scope Process -ExecutionPolicy RemoteSigned -Force`.
- If the analyzer/IntelliSense complains about missing packages, ensure you selected the `.venv` interpreter **and** installed `pip install -r requirements.txt`.

---

## Useful commands (copy/paste)
- Start DB: `docker-compose up -d`
- Apply migrations: `python -m alembic upgrade head`
- Start backend (dev): `python -m uvicorn server.main:app --reload --port 5000`
- Run tests: `pytest`
- Format: `black .` — Lint: `ruff .`

---

If you want, I can extend this document with a short `CONTRIBUTING.md` that adds branch/PR rules, testing requirements, and CI details. Want me to add that? (yes/no)
